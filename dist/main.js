!function(e){var t={};function r(n){if(t[n])return t[n].exports;var l=t[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,r),l.l=!0,l.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)r.d(n,l,function(t){return e[t]}.bind(null,l));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t){e.exports=React},function(e,t,r){"use strict";function n(e,t){return[e[0]*t[0]-e[1]*t[1]-e[2]*t[2]-e[3]*t[3],e[0]*t[1]+e[1]*t[0]+e[2]*t[3]-e[3]*t[2],e[0]*t[2]-e[1]*t[3]+e[2]*t[0]+e[3]*t[1],e[0]*t[3]+e[1]*t[2]-e[2]*t[1]+e[3]*t[0]]}Object.defineProperty(t,"__esModule",{value:!0}),t.eToQ=function(e){let t=Math.sin(e[3]/2);return[Math.cos(e[3]/2),e[0]*t,e[1]*t,e[2]*t]},t.qMultiply=n,t.qRotate=function(e,t){let r=t.map(e=>e*e).reduce((e,t)=>e+t,0),[l,o,i,a]=n(n(t,[0,e[0],e[1],e[2]]),[(c=t)[0],-c[1],-c[2],-c[3]]);var c;return[o/r,i/r,a/r]}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const l=n(r(0)),o=n(r(3)),i=r(4),a=r(6),c=r(8);function u(){let[e,t]=l.useState(),[r,n]=l.useState();return l.useEffect(()=>{fetch("/videos").then(e=>e.json()).then(e=>n(e.videos))},[]),l.createElement("div",{className:"main-layout"},l.createElement(a.VideoListing,{callback:t,videos:r||[]}),e?l.createElement(i.VideoController,{width:700,url:`/video?id=${e}`,callback:e=>{fetch("/skateboards",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)})}}):l.createElement(c.ClipViewer,null))}t.PanelLayout=u,o.render(l.createElement(u,null),document.getElementById("root"))},function(e,t){e.exports=ReactDOM},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const l=n(r(0)),o=r(5),i=r(7);t.VideoController=function(e){var t;let[r,n]=l.useState(!0),[a,c]=l.useState([0,0]),[u,d]=l.useState([]),[s,f]=l.useState([0,0,0,0]),[h,v]=l.useState([Math.SQRT1_2,Math.SQRT1_2,0,0]),R=l.createRef(),[O,m]=l.useState(null),b=l.useCallback(e=>{e&&m(e)},[]);const p=t=>{if(!R.current||!O)return null;let{clientX:r,clientY:n}=t,{top:l,left:o}=R.current.getBoundingClientRect();return[(r-o)*O.videoWidth/e.width,(n-l)*O.videoWidth/e.width]},B=()=>{if(r)return;if(!O)return;if(!R.current)return;let{width:e,height:t}=R.current,n=R.current.getContext("2d");if(!n)return;if(n.clearRect(0,0,e,t),n.drawImage(O,0,0),i.drawBoundingBox(n,e,t,s),u.length>0)return;let{top:l,left:a,right:c,bottom:d}=i.describeBox(s),f=Math.max(c-a,d-l),v=(d-l-f)/2;e-c>a?o.renderSkateboard(n,h,[c+i.BOX_BORDER,l+v,c+f+i.BOX_BORDER,d-v]):o.renderSkateboard(n,h,[a-f-i.BOX_BORDER,l+v,a-i.BOX_BORDER,d-v])};l.useEffect(B,[r,O,s,h,null===(t=O)||void 0===t?void 0:t.currentTime]);const E=()=>{var e,t;r?(n(!1),null===(e=O)||void 0===e||e.pause()):(n(!0),null===(t=O)||void 0===t||t.play())},_=()=>{O&&(O.currentTime+=.05)},y=()=>{O&&(O.currentTime-=.05)},g=t=>{if(!R.current)return;let r=R.current.getContext("2d");if(!r)return;let{top:n,left:l,right:o,bottom:a}=i.describeBox(s),c=document.createElement("canvas");c.width=o-l,c.height=a-n;let u=r.getImageData(...s);r=c.getContext("2d"),r&&(r.putImageData(u,0,0),e.callback({input:{width:Math.round(o-l),height:Math.round(a-n),data:c.toDataURL()},output:{isSkateboard:t?1:0,rotation:h}}),_())},S=()=>{v([1,0,0,0])};return window.onkeydown=e=>{switch(e.key){case"r":case"R":S();break;case"Enter":g(!e.shiftKey);break;case"ArrowRight":_();break;case"ArrowLeft":y();break;case" ":E()}},l.createElement("div",{className:"video-container"},l.createElement("video",{onTimeUpdate:B,ref:b,autoPlay:!0,controls:!0,style:{display:r?"block":"none",width:e.width}},l.createElement("source",{src:e.url,type:"video/mp4"})),null!=O&&l.createElement("canvas",{ref:R,width:O.videoWidth,height:O.videoHeight,style:{display:r?"none":"block",width:e.width,height:e.width*O.videoHeight/(O.videoWidth+1),border:"1px solid black"},onMouseDown:e=>{let t=p(e);if(!t)return;let[r,n]=t;c(t),d(i.chooseDraggingIndexes(s,r,n)),i.isInsideBox(s,r,n)||f([r,n,r,n])},onMouseMove:e=>{let t=p(e);if(!t)return;let r=t[0]-a[0],n=t[1]-a[1];e.preventDefault(),c(t),u.length?f(i.dragBoxBounds(s,r,n,u)):v(o.rotateSkateboard(r,n,h))},onWheel:e=>{v(o.tiltSkateboard(e.deltaY,h))},onMouseLeave:()=>d([]),onMouseOut:()=>d([]),onMouseUp:()=>d([])}),l.createElement("br",null),l.createElement("div",{className:"video-controls",style:{width:e.width}},l.createElement("div",{className:"video-controls-button",onClick:E},r?"Pause":"Play"," (Spacebar)"),l.createElement("div",{className:"video-controls-button",onClick:y},"Back a little (Left Arrow)"),l.createElement("div",{className:"video-controls-button",onClick:_},"Forward a little (Right Arrow)"),l.createElement("div",{className:"video-controls-button",onClick:()=>g(!0)},"Clip Skateboard (Enter)"),l.createElement("div",{className:"video-controls-button",onClick:()=>g(!1)},"Clip Not-a-Skateboard (Shift Enter)"),l.createElement("div",{className:"video-controls-button",onClick:S},"Reset Skateboard Orientation (R)")))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),l=[[2,.5,0],[2,-.5,0],[2.5,0,.25],[-2,.5,0],[-2,-.5,0],[-2.5,0,.25],[1.75,0,0],[1.75,-.5,-.5],[1.75,.5,-.5],[-1.75,0,0],[-1.75,-.5,-.5],[-1.75,.5,-.5]],o=[[0,1,2],[0,1,3],[1,3,4],[3,4,5]],i=[[6,7,8],[9,10,11]];t.renderSkateboard=function(e,t,r){let a=n.qRotate([1,0,0],t)[0],c=n.qRotate([0,0,1],t)[2],u=l.map(e=>n.qRotate(e,t)).map(([e,t,r])=>[e,t,r-10]).map(([e,t,r])=>[-1.5*e/r,-1.5*t/r,r]);e.fillStyle="white",e.fillRect(r[0],r[1],r[2]-r[0],r[3]-r[1]);let d=4*Math.abs(r[0]-r[2])/2,s=(r[0]+r[2])/2,f=(r[1]+r[3])/2;c>0&&i.forEach(([t,r,n])=>{let[l,o]=u[t],[i,a]=u[r],[c,h]=u[n];e.fillStyle="#C9C9C9",e.beginPath(),e.moveTo(l*d+s,o*d+f),e.lineTo(i*d+s,a*d+f),e.lineTo(c*d+s,h*d+f),e.closePath(),e.fill(),e.stroke()}),(a>0?o:o.reverse()).forEach(([t,r,n])=>{let[l,o]=u[t],[i,a]=u[r],[h,v]=u[n];e.fillStyle=c>0?"black":"red",e.strokeStyle="#d8d8d8",e.beginPath(),e.moveTo(l*d+s,o*d+f),e.lineTo(i*d+s,a*d+f),e.lineTo(h*d+s,v*d+f),e.closePath(),e.fill(),e.stroke()}),c<0&&i.forEach(([t,r,n])=>{let[l,o]=u[t],[i,a]=u[r],[c,h]=u[n];e.fillStyle="#C9C9C9",e.beginPath(),e.moveTo(l*d+s,o*d+f),e.lineTo(i*d+s,a*d+f),e.lineTo(c*d+s,h*d+f),e.closePath(),e.fill(),e.stroke()})},t.rotateSkateboard=function(e,t,r){t*=1.5;let l=Math.sqrt(e*e+t*t),o=n.eToQ([t/l,0,-e/l,l/100]),i=n.qMultiply(r,o),[a]=n.qRotate([1,0,0],i);return a>0?i:r},t.tiltSkateboard=function(e,t){let r=n.eToQ([0,1,0,e/100]),l=n.qMultiply(t,r),[o]=n.qRotate([1,0,0],l);return o>0?l:t}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const l=n(r(0));t.VideoListing=function(e){let t=l.createRef(),[r,n]=l.useState();return l.createElement("div",{className:"title-container"},l.createElement("div",{className:"title-cell"},l.createElement("input",{type:"url",ref:t,placeholder:"youtube url"}),l.createElement("button",{onClick:e=>{var r;fetch("/video",{method:"POST",body:JSON.stringify({link:null===(r=t.current)||void 0===r?void 0:r.value}),headers:{"Content-Type":"application/json"}}).then(()=>{location.reload()})}},"Download video")),e.videos.map(({id:t,title:o},i)=>l.createElement("div",{key:i,className:"title-cell",onClick:()=>{e.callback(t),n(o)},style:{color:o==r?"red":"black"}},o)))}},function(e,t,r){"use strict";function n(e){let[t,r,n,l]=e;return{top:Math.min(r,l),bottom:Math.max(r,l),left:Math.min(t,n),right:Math.max(t,n)}}function l(e,r,l){let{top:o,bottom:i,left:a,right:c}=n(e);return r+t.BOX_BORDER>a&&l+t.BOX_BORDER>o&&r-t.BOX_BORDER<c&&l-t.BOX_BORDER<i}Object.defineProperty(t,"__esModule",{value:!0}),t.BOX_BORDER=12,t.describeBox=n,t.drawBoundingBox=function(e,r,l,o){let{left:i,top:a,bottom:c,right:u}=n(o);e.fillStyle="rgba(0, 0, 0, .5)",e.fillRect(0,0,i,c),e.fillRect(i,0,r,a),e.fillRect(u,a,r,l),e.fillRect(0,c,u,l),e.fillStyle="#33b5e5",e.fillRect(i-t.BOX_BORDER,a,t.BOX_BORDER,c-a),e.fillRect(i,a-t.BOX_BORDER,u-i,t.BOX_BORDER),e.fillRect(u,a,t.BOX_BORDER,c-a),e.fillRect(i,c,u-i,t.BOX_BORDER),e.fillStyle="#ace1f4",e.fillRect(i-t.BOX_BORDER,a-t.BOX_BORDER,t.BOX_BORDER,t.BOX_BORDER),e.fillRect(u,a-t.BOX_BORDER,t.BOX_BORDER,t.BOX_BORDER),e.fillRect(i-t.BOX_BORDER,c,t.BOX_BORDER,t.BOX_BORDER),e.fillRect(u,c,t.BOX_BORDER,t.BOX_BORDER)},t.dragBoxBounds=function(e,t,r,n){let[l,o,i,a]=e;return-1!=n.indexOf(0)&&(l+=t),-1!=n.indexOf(1)&&(o+=r),-1!=n.indexOf(2)&&(i+=t),-1!=n.indexOf(3)&&(a+=r),[Math.floor(l),Math.floor(o),Math.floor(i),Math.floor(a)]},t.chooseDraggingIndexes=function(e,r,o){if(!l(e,r,o))return[2,3];let{top:i,bottom:a,left:c,right:u}=n(e),d=[];return r+t.BOX_BORDER>c&&r<c&&d.push(c==e[0]?0:2),o+t.BOX_BORDER>i&&o<i&&d.push(i==e[1]?1:3),r>u&&r-u<t.BOX_BORDER&&d.push(u==e[2]?2:0),o>a&&o-a<t.BOX_BORDER&&d.push(a==e[3]?3:1),d},t.isInsideBox=l},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const l=n(r(0)),o=r(5);function i(e){var t;let[r,n]=l.useState();l.useEffect(()=>{fetch(`/skateboards?id=${e.id}`).then(e=>e.json()).then(e=>n(e))},[]);let[i,a]=l.useState(!1),c=l.createRef();return l.useEffect(()=>{var e,t,n;let l=null===(e=c.current)||void 0===e?void 0:e.getContext("2d"),a=null===(t=c.current)||void 0===t?void 0:t.width,u=null===(n=c.current)||void 0===n?void 0:n.height;l&&a&&u&&(l.fillStyle="white",l.fillRect(0,0,a,u),l.textAlign="center",l.fillStyle="black",r?i?l.fillText("Deleted",a/2,u/2):r.output.isSkateboard?o.renderSkateboard(l,r.output.rotation,[.2*a,.2*u,.8*a,.8*u]):l.fillText("Not a Skateboard",a/2,u/2):l.fillText("Loading...",a/2,u/2))},[r,c.current]),l.createElement("div",{className:"clip"},l.createElement("div",null,l.createElement("h3",null,"Clip ",e.id),l.createElement("button",{onClick:()=>{fetch(`/skateboards?id=${e.id}`,{method:"DELETE"}).then(e=>e.json()).then(e=>a(!0))}},"Delete this clip")),l.createElement("img",{src:null===(t=r)||void 0===t?void 0:t.input.data,style:{objectFit:"contain",width:2*e.size,height:e.size}}),l.createElement("canvas",{ref:c,width:2*e.size,height:e.size,style:{width:2*e.size,height:e.size}}))}t.ClipViewer=function(){var e;let[t,r]=l.useState();return l.useEffect(()=>{fetch("/skateboards").then(e=>e.json()).then(e=>r(e))},[]),l.createElement("div",{className:"clip-container"},null===(e=t)||void 0===e?void 0:e.labels.sort().map(e=>l.createElement(i,{key:e,size:100,id:e})))}}]);