!function(e){var t={};function l(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,l),o.l=!0,o.exports}l.m=e,l.c=t,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)l.d(n,o,function(t){return e[t]}.bind(null,o));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="",l(l.s=2)}([function(e,t){e.exports=React},function(e,t,l){"use strict";function n(e,t){return[e[0]*t[0]-e[1]*t[1]-e[2]*t[2]-e[3]*t[3],e[0]*t[1]+e[1]*t[0]+e[2]*t[3]-e[3]*t[2],e[0]*t[2]-e[1]*t[3]+e[2]*t[0]+e[3]*t[1],e[0]*t[3]+e[1]*t[2]-e[2]*t[1]+e[3]*t[0]]}Object.defineProperty(t,"__esModule",{value:!0}),t.eToQ=function(e){let t=Math.sin(e[3]/2);return[Math.cos(e[3]/2),e[0]*t,e[1]*t,e[2]*t]},t.qMultiply=n,t.qRotate=function(e,t){let l=t.map(e=>e*e).reduce((e,t)=>e+t,0),[o,r,i,a]=n(n(t,[0,e[0],e[1],e[2]]),[(c=t)[0],-c[1],-c[2],-c[3]]);var c;return[r/l,i/l,a/l]}},function(e,t,l){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var l in e)Object.hasOwnProperty.call(e,l)&&(t[l]=e[l]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(l(0)),r=n(l(3)),i=l(4),a=l(6),c=l(8);function u(){let[e,t]=o.useState(),[l,n]=o.useState(0),[r,u]=o.useState();return o.createElement("div",{className:"main-layout"},o.createElement(a.VideoListing,{callback:e=>{t(void 0),setTimeout(()=>t(e))}}),e?o.createElement(i.VideoController,{width:700,url:`/video?id=${e}`,callback:e=>{u(void 0),fetch("/skateboards",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)}).then(e=>e.json()).then(({id:t})=>{u(e),n(t)})}}):o.createElement(c.ClipViewer,null),r&&o.createElement(c.ClipCell,{size:100,label:Object.assign(Object.assign({},r),{id:l})}))}t.PanelLayout=u,r.render(o.createElement(u,null),document.getElementById("root"))},function(e,t){e.exports=ReactDOM},function(e,t,l){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var l in e)Object.hasOwnProperty.call(e,l)&&(t[l]=e[l]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(l(0)),r=l(5),i=l(7);t.VideoController=function(e){var t;let[l,n]=o.useState(!0),[a,c]=o.useState([0,0]),[u,d]=o.useState([]),[s,f]=o.useState([0,0,0,0]),[h,b]=o.useState([Math.SQRT1_2,Math.SQRT1_2,0,0]),v=o.createRef(),[m,O]=o.useState(null),R=o.useCallback(e=>{e&&O(e)},[]);const p=t=>{if(!v.current||!m)return null;let{clientX:l,clientY:n}=t,{top:o,left:r}=v.current.getBoundingClientRect();return[(l-r)*m.videoWidth/e.width,(n-o)*m.videoWidth/e.width]},E=()=>{if(l)return;if(!m)return;if(!v.current)return;let{width:e,height:t}=v.current,n=v.current.getContext("2d");if(!n)return;if(n.clearRect(0,0,e,t),n.drawImage(m,0,0),i.drawBoundingBox(n,e,t,s),u.length>0)return;let{top:o,left:a,right:c,bottom:d}=i.describeBox(s),f=Math.max(c-a,d-o),b=(d-o-f)/2;e-c>a?r.renderSkateboard(n,h,[c+i.BOX_BORDER,o+b,c+f+i.BOX_BORDER,d-b]):r.renderSkateboard(n,h,[a-f-i.BOX_BORDER,o+b,a-i.BOX_BORDER,d-b])};o.useEffect(E,[l,m,s,h,null===(t=m)||void 0===t?void 0:t.currentTime]);const B=()=>{var e,t;l?(n(!1),null===(e=m)||void 0===e||e.pause()):(n(!0),null===(t=m)||void 0===t||t.play())},_=()=>{m&&(m.currentTime+=.05)},g=()=>{m&&(m.currentTime-=.05)},y=t=>{if(!v.current)return;let l=v.current.getContext("2d");if(!l)return;let{top:n,left:o,right:r,bottom:a}=i.describeBox(s),c=document.createElement("canvas");c.width=r-o,c.height=a-n;let u=l.getImageData(o,n,r,a),d=c.getContext("2d");d&&(d.putImageData(u,0,0),e.callback({input:{width:Math.round(r-o),height:Math.round(a-n),data:c.toDataURL()},output:{isSkateboard:t?1:0,rotation:h}}),_())},S=()=>{b([1,0,0,0])};return window.onkeydown=e=>{switch(e.key){case"r":case"R":S();break;case"Enter":y(!e.shiftKey);break;case"ArrowRight":_();break;case"ArrowLeft":g();break;case" ":B()}},o.createElement("div",{className:"video-container"},o.createElement("video",{onTimeUpdate:E,ref:R,autoPlay:!0,controls:!0,style:{display:l?"block":"none",width:e.width}},o.createElement("source",{src:e.url,type:"video/mp4"})),null!=m&&o.createElement("canvas",{ref:v,width:m.videoWidth,height:m.videoHeight,style:{display:l?"none":"block",width:e.width,height:e.width*m.videoHeight/(m.videoWidth+1),border:"1px solid black"},onMouseDown:e=>{let t=p(e);if(!t)return;let[l,n]=t;c(t),d(i.chooseDraggingIndexes(s,l,n)),i.isInsideBox(s,l,n)||f([l,n,l,n])},onMouseMove:e=>{let t=p(e);if(!t)return;let l=t[0]-a[0],n=t[1]-a[1];e.preventDefault(),c(t),u.length?f(i.dragBoxBounds(s,l,n,u)):b(r.rotateSkateboard(l,n,h))},onWheel:e=>{b(r.tiltSkateboard(e.deltaY,h))},onMouseLeave:()=>d([]),onMouseOut:()=>d([]),onMouseUp:()=>d([])}),o.createElement("br",null),o.createElement("div",{className:"video-controls",style:{width:e.width}},o.createElement("div",{className:"video-controls-button",onClick:B},l?"Pause":"Play"," (Spacebar)"),o.createElement("div",{className:"video-controls-button",onClick:g},"Back a little (Left Arrow)"),o.createElement("div",{className:"video-controls-button",onClick:_},"Forward a little (Right Arrow)"),o.createElement("div",{className:"video-controls-button",onClick:()=>y(!0)},"Clip Skateboard (Enter)"),o.createElement("div",{className:"video-controls-button",onClick:()=>y(!1)},"Clip Not-a-Skateboard (Shift Enter)"),o.createElement("div",{className:"video-controls-button",onClick:S},"Reset Skateboard Orientation (R)")))}},function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=l(1),o=[[2,.5,0],[2,-.5,0],[2.5,0,.25],[-2,.5,0],[-2,-.5,0],[-2.5,0,.25],[1.75,0,0],[1.75,-.5,-.5],[1.75,.5,-.5],[-1.75,0,0],[-1.75,-.5,-.5],[-1.75,.5,-.5]],r=[[0,1,2],[0,1,3],[1,3,4],[3,4,5]],i=[[6,7,8],[9,10,11]];t.renderSkateboard=function(e,t,l){let a=n.qRotate([1,0,0],t)[0],c=n.qRotate([0,0,1],t)[2],u=o.map(e=>n.qRotate(e,t)).map(([e,t,l])=>[e,t,l-10]).map(([e,t,l])=>[-1.5*e/l,-1.5*t/l,l]);e.fillStyle="white",e.fillRect(l[0],l[1],l[2]-l[0],l[3]-l[1]);let d=2*Math.abs(l[0]-l[2])/2,s=(l[0]+l[2])/2,f=(l[1]+l[3])/2;c>0&&i.forEach(([t,l,n])=>{let[o,r]=u[t],[i,a]=u[l],[c,h]=u[n];e.fillStyle="#C9C9C9",e.beginPath(),e.moveTo(o*d+s,r*d+f),e.lineTo(i*d+s,a*d+f),e.lineTo(c*d+s,h*d+f),e.closePath(),e.fill(),e.stroke()}),(a>0?r:r.reverse()).forEach(([t,l,n])=>{let[o,r]=u[t],[i,a]=u[l],[h,b]=u[n];e.fillStyle=c>0?"black":"red",e.strokeStyle="#d8d8d8",e.beginPath(),e.moveTo(o*d+s,r*d+f),e.lineTo(i*d+s,a*d+f),e.lineTo(h*d+s,b*d+f),e.closePath(),e.fill(),e.stroke()}),c<0&&i.forEach(([t,l,n])=>{let[o,r]=u[t],[i,a]=u[l],[c,h]=u[n];e.fillStyle="#C9C9C9",e.beginPath(),e.moveTo(o*d+s,r*d+f),e.lineTo(i*d+s,a*d+f),e.lineTo(c*d+s,h*d+f),e.closePath(),e.fill(),e.stroke()})},t.rotateSkateboard=function(e,t,l){t*=1.5;let o=Math.sqrt(e*e+t*t),r=n.eToQ([t/o,0,-e/o,o/100]),i=n.qMultiply(l,r),[a]=n.qRotate([1,0,0],i);return a>0?i:l},t.tiltSkateboard=function(e,t){let l=n.eToQ([0,1,0,e/100]),o=n.qMultiply(t,l),[r]=n.qRotate([1,0,0],o);return r>0?o:t}},function(e,t,l){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var l in e)Object.hasOwnProperty.call(e,l)&&(t[l]=e[l]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(l(0));t.VideoListing=function(e){let t=o.createRef(),[l,n]=o.useState(!1),[r,i]=o.useState(),[a,c]=o.useState([]);return o.useEffect(()=>{fetch("/videos").then(e=>e.json()).then(e=>c(e.videos))},[]),o.createElement("div",{className:"title-container"},o.createElement("div",{className:"title-cell"},o.createElement("input",{type:"url",ref:t,placeholder:"youtube url"}),o.createElement("button",{disabled:l,onClick:()=>{var o;if(l)return;let u=null===(o=t.current)||void 0===o?void 0:o.value;if(!/https:\/\/www.youtube.com\/watch\?v=[a-zA-Z0-9]+/.test(u||""))return;n(!0);let d=new WebSocket(`ws${"https"===window.location.protocol?"s":""}://${window.location.host}/video-download`);d.onopen=()=>{console.log("sending",u),d.send(JSON.stringify({link:u}))},d.onmessage=function(e){let t=JSON.parse(e.data);"error"in t?(i(void 0),alert(t.error)):r&&r.id==t.id||(c([t,...a]),i(t))},d.onclose=()=>{r&&e.callback(r.id),n(!1)}}},"Download video")),a.map(({id:t,title:l,progress:n},u)=>o.createElement("div",{key:u,className:"title-cell"},o.createElement("h3",{onClick:()=>{e.callback(t),i({id:t,title:l,progress:n})},style:{color:r&&t==r.id?"red":"black"}}," ",l," ",100!=n?` ${n}% downloaded`:""," "),o.createElement("button",{onClick:()=>{fetch(`/video?id=${t}`,{method:"DELETE"}).then(e=>c(a.filter(e=>t!=e.id)))}},"Delete"))))}},function(e,t,l){"use strict";function n(e){let[t,l,n,o]=e;return{top:Math.min(l,o),bottom:Math.max(l,o),left:Math.min(t,n),right:Math.max(t,n)}}function o(e,l,o){let{top:r,bottom:i,left:a,right:c}=n(e);return l+t.BOX_BORDER>a&&o+t.BOX_BORDER>r&&l-t.BOX_BORDER<c&&o-t.BOX_BORDER<i}Object.defineProperty(t,"__esModule",{value:!0}),t.BOX_BORDER=12,t.describeBox=n,t.drawBoundingBox=function(e,l,o,r){let{left:i,top:a,bottom:c,right:u}=n(r);e.fillStyle="rgba(0, 0, 0, .5)",e.fillRect(0,0,i,c),e.fillRect(i,0,l,a),e.fillRect(u,a,l,o),e.fillRect(0,c,u,o),e.fillStyle="#33b5e5",e.fillRect(i-t.BOX_BORDER,a,t.BOX_BORDER,c-a),e.fillRect(i,a-t.BOX_BORDER,u-i,t.BOX_BORDER),e.fillRect(u,a,t.BOX_BORDER,c-a),e.fillRect(i,c,u-i,t.BOX_BORDER),e.fillStyle="#ace1f4",e.fillRect(i-t.BOX_BORDER,a-t.BOX_BORDER,t.BOX_BORDER,t.BOX_BORDER),e.fillRect(u,a-t.BOX_BORDER,t.BOX_BORDER,t.BOX_BORDER),e.fillRect(i-t.BOX_BORDER,c,t.BOX_BORDER,t.BOX_BORDER),e.fillRect(u,c,t.BOX_BORDER,t.BOX_BORDER)},t.dragBoxBounds=function(e,t,l,n){let[o,r,i,a]=e;return-1!=n.indexOf(0)&&(o+=t),-1!=n.indexOf(1)&&(r+=l),-1!=n.indexOf(2)&&(i+=t),-1!=n.indexOf(3)&&(a+=l),[Math.floor(o),Math.floor(r),Math.floor(i),Math.floor(a)]},t.chooseDraggingIndexes=function(e,l,r){if(!o(e,l,r))return[2,3];let{top:i,bottom:a,left:c,right:u}=n(e),d=[];return l+t.BOX_BORDER>c&&l<c&&d.push(c==e[0]?0:2),r+t.BOX_BORDER>i&&r<i&&d.push(i==e[1]?1:3),l>u&&l-u<t.BOX_BORDER&&d.push(u==e[2]?2:0),r>a&&r-a<t.BOX_BORDER&&d.push(a==e[3]?3:1),d},t.isInsideBox=o},function(e,t,l){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var l in e)Object.hasOwnProperty.call(e,l)&&(t[l]=e[l]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(l(0)),r=l(5);function i(e){var t;let[l,n]=o.useState();o.useEffect(()=>{e.label.input&&e.label.output?(console.log("passed"),n(e.label)):fetch(`/skateboards?id=${e.label.id}`).then(e=>e.json()).then(e=>n(e))},[]);let[i,a]=o.useState(!1),c=o.createRef();return o.useEffect(()=>{var e,t,n;let o=null===(e=c.current)||void 0===e?void 0:e.getContext("2d"),a=null===(t=c.current)||void 0===t?void 0:t.width,u=null===(n=c.current)||void 0===n?void 0:n.height;o&&a&&u&&(o.fillStyle="white",o.fillRect(0,0,a,u),o.textAlign="center",o.fillStyle="black",i?o.fillText("Deleted",a/2,u/2):l?l.output.isSkateboard?r.renderSkateboard(o,l.output.rotation,[.2*a,.2*u,.8*a,.8*u]):o.fillText("Not a Skateboard",a/2,u/2):o.fillText("Loading...",a/2,u/2))},[l,i,c.current]),o.createElement("div",{className:"clip"},o.createElement("div",null,o.createElement("h3",null,i?"Deleted!":`Clip ${e.label.id}`),o.createElement("button",{onClick:()=>{fetch(`/skateboards?id=${e.label.id}`,{method:"DELETE"}).then(e=>a(!0))},disabled:i},"Delete")),o.createElement("img",{src:null===(t=l)||void 0===t?void 0:t.input.data,style:{objectFit:"contain",width:2*e.size,height:e.size}}),o.createElement("canvas",{ref:c,width:2*e.size,height:e.size,style:{width:2*e.size,height:e.size}}))}t.ClipViewer=function(){var e;let[t,l]=o.useState();return o.useEffect(()=>{fetch("/skateboards").then(e=>e.json()).then(e=>l(e))},[]),o.createElement("div",{className:"clip-container"},null===(e=t)||void 0===e?void 0:e.labels.map(e=>o.createElement(i,{key:e,size:100,label:{id:e}})))},t.ClipCell=i}]);