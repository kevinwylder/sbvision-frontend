!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t){e.exports=React},function(e,t,r){"use strict";function n(e,t){return[e[0]*t[0]-e[1]*t[1]-e[2]*t[2]-e[3]*t[3],e[0]*t[1]+e[1]*t[0]+e[2]*t[3]-e[3]*t[2],e[0]*t[2]-e[1]*t[3]+e[2]*t[0]+e[3]*t[1],e[0]*t[3]+e[1]*t[2]-e[2]*t[1]+e[3]*t[0]]}Object.defineProperty(t,"__esModule",{value:!0}),t.eToQ=function(e){let t=Math.sin(e[3]/2);return[Math.cos(e[3]/2),e[0]*t,e[1]*t,e[2]*t]},t.qMultiply=n,t.qRotate=function(e,t){let r=t.map(e=>e*e).reduce((e,t)=>e+t,0),[o,l,i,a]=n(n(t,[0,e[0],e[1],e[2]]),[(c=t)[0],-c[1],-c[2],-c[3]]);var c;return[l/r,i/r,a/r]}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(0)),l=n(r(3)),i=r(4),a=r(6);function c(){let[e,t]=o.useState(),[r,n]=o.useState();return o.useEffect(()=>{fetch("/videos").then(e=>e.json()).then(e=>n(e.videos))},[]),e?o.createElement(i.VideoController,{width:700,url:`/video?id=${e}`,callback:e=>{fetch("/skateboards",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)})}}):o.createElement(a.VideoListing,{callback:t,videos:r||[]})}t.PanelLayout=c,l.render(o.createElement(c,null),document.getElementById("root"))},function(e,t){e.exports=ReactDOM},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(0)),l=r(5),i=r(7);t.VideoController=function(e){var t;let[r,n]=o.useState(!0),[a,c]=o.useState([0,0]),[u,d]=o.useState([]),[s,f]=o.useState([0,0,0,0]),[R,O]=o.useState([Math.SQRT1_2,Math.SQRT1_2,0,0]),h=o.createRef(),[B,v]=o.useState(null),p=o.useCallback(e=>{e&&v(e)},[]);const b=t=>{if(!h.current||!B)return null;let{clientX:r,clientY:n}=t,{top:o,left:l}=h.current.getBoundingClientRect();return[(r-l)*B.videoWidth/e.width,(n-o)*B.videoWidth/e.width]},m=()=>{if(r)return;if(!B)return;if(!h.current)return;let{width:e,height:t}=h.current,n=h.current.getContext("2d");if(!n)return;if(n.clearRect(0,0,e,t),n.drawImage(B,0,0),i.drawBoundingBox(n,e,t,s),u.length>0)return;let{top:o,left:a,right:c,bottom:d}=i.describeBox(s),f=Math.max(c-a,d-o),O=(d-o-f)/2;e-c>a?l.renderSkateboard(n,R,[c+i.BOX_BORDER,o+O,c+f+i.BOX_BORDER,d-O]):l.renderSkateboard(n,R,[a-f-i.BOX_BORDER,o+O,a-i.BOX_BORDER,d-O])};o.useEffect(m,[r,B,s,R,null===(t=B)||void 0===t?void 0:t.currentTime]);const _=()=>{var e,t;r?(n(!1),null===(e=B)||void 0===e||e.pause()):(n(!0),null===(t=B)||void 0===t||t.play())},E=()=>{B&&(B.currentTime+=.05)},y=()=>{B&&(B.currentTime-=.05)},g=t=>{if(!h.current)return;let r=h.current.getContext("2d");if(!r)return;let{top:n,left:o,right:l,bottom:a}=i.describeBox(s),c=document.createElement("canvas");c.width=l-o,c.height=a-n;let u=r.getImageData(...s);r=c.getContext("2d"),r&&(r.putImageData(u,0,0),e.callback({input:{width:Math.round(l-o),height:Math.round(a-n),data:c.toDataURL()},output:{isSkateboard:t?1:0,rotation:R}}),E())},S=()=>{O([1,0,0,0])};return window.onkeydown=e=>{switch(e.key){case"r":case"R":S();break;case"Enter":g(!e.shiftKey);break;case"ArrowRight":E();break;case"ArrowLeft":y();break;case" ":_()}},o.createElement("div",{className:"video-container"},o.createElement("video",{onTimeUpdate:m,ref:p,controls:!0,style:{display:r?"block":"none",width:e.width}},o.createElement("source",{src:e.url,type:"video/mp4"})),null!=B&&o.createElement("canvas",{ref:h,width:B.videoWidth,height:B.videoHeight,style:{display:r?"none":"block",width:e.width,height:e.width*B.videoHeight/(B.videoWidth+1),border:"1px solid black"},onMouseDown:e=>{let t=b(e);if(!t)return;let[r,n]=t;c(t),d(i.chooseDraggingIndexes(s,r,n)),i.isInsideBox(s,r,n)||f([r,n,r,n])},onMouseMove:e=>{let t=b(e);if(!t)return;let r=t[0]-a[0],n=t[1]-a[1];e.preventDefault(),c(t),u.length?f(i.dragBoxBounds(s,r,n,u)):O(l.rotateSkateboard(r,n,R))},onWheel:e=>{O(l.tiltSkateboard(e.deltaY,R))},onMouseLeave:()=>d([]),onMouseOut:()=>d([]),onMouseUp:()=>d([])}),o.createElement("br",null),o.createElement("div",{className:"video-controls",style:{width:e.width}},o.createElement("div",{className:"video-controls-button",onClick:_},r?"Pause":"Play"," (Spacebar)"),o.createElement("div",{className:"video-controls-button",onClick:y},"Back a little (Left Arrow)"),o.createElement("div",{className:"video-controls-button",onClick:E},"Forward a little (Right Arrow)"),o.createElement("div",{className:"video-controls-button",onClick:()=>g(!0)},"Clip Skateboard (Enter)"),o.createElement("div",{className:"video-controls-button",onClick:()=>g(!1)},"Clip Not-a-Skateboard (Shift Enter)"),o.createElement("div",{className:"video-controls-button",onClick:S},"Reset Skateboard Orientation (R)")))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),o=[[2,.5,0],[2,-.5,0],[2.5,0,.25],[-2,.5,0],[-2,-.5,0],[-2.5,0,.25],[1.75,0,0],[1.75,-.5,-.5],[1.75,.5,-.5],[-1.75,0,0],[-1.75,-.5,-.5],[-1.75,.5,-.5]],l=[[0,1,2],[0,1,3],[1,3,4],[3,4,5],[6,7,8],[9,10,11]];t.renderSkateboard=function(e,t,r){let i=o.map(e=>n.qRotate(e,t)).map(([e,t,r])=>[e,t,r-10]).map(([e,t,r])=>[-1.5*e/r,-1.5*t/r,r]),a=l.map(([e,t,r],n)=>[Math.min(i[e][2]+i[t][2]+i[r][2]),n]);a=a.sort(([e],[t])=>e-t),e.fillStyle="white",e.fillRect(r[0],r[1],r[2]-r[0],r[3]-r[1]);let c=9*Math.abs(r[0]-r[2])/2,u=(r[0]+r[2])/2,d=(r[1]+r[3])/2;a.forEach(([t,r])=>{let[n,o,a]=l[r],[s,f]=i[n],[R,O]=i[o],[h,B]=i[a];e.fillStyle="black",e.strokeStyle="#d8d8d8",e.beginPath(),e.moveTo(s*c+u,f*c+d),e.lineTo(R*c+u,O*c+d),e.lineTo(h*c+u,B*c+d),e.closePath(),e.fill(),e.stroke()})},t.rotateSkateboard=function(e,t,r){t*=1.5;let o=Math.sqrt(e*e+t*t),l=n.eToQ([t/o,0,-e/o,o/100]),i=n.qMultiply(r,l),[a]=n.qRotate([1,0,0],i);return a>0?i:r},t.tiltSkateboard=function(e,t){let r=n.eToQ([0,1,0,e/100]),o=n.qMultiply(t,r),[l]=n.qRotate([1,0,0],o);return l>0?o:t}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(0));t.VideoListing=function(e){let t=o.createRef(),[r,n]=o.useState();return o.createElement("div",{className:"title-container"},o.createElement("input",{type:"url",ref:t}),o.createElement("button",{onClick:e=>{var r;fetch("/video",{method:"POST",body:JSON.stringify({link:null===(r=t.current)||void 0===r?void 0:r.value}),headers:{"Content-Type":"application/json"}}).then(()=>{location.reload()})}},"Download video"),e.videos.map(({id:t,title:l},i)=>o.createElement("div",{key:i,className:"title-cell",onClick:()=>{e.callback(t),n(l)},style:{color:l==r?"red":"black"}},l)))}},function(e,t,r){"use strict";function n(e){let[t,r,n,o]=e;return{top:Math.min(r,o),bottom:Math.max(r,o),left:Math.min(t,n),right:Math.max(t,n)}}function o(e,r,n){return r>e[0]-t.BOX_BORDER&&n>e[1]-t.BOX_BORDER&&r<e[2]+t.BOX_BORDER&&n<e[3]+t.BOX_BORDER}Object.defineProperty(t,"__esModule",{value:!0}),t.BOX_BORDER=12,t.describeBox=n,t.drawBoundingBox=function(e,r,o,l){let{left:i,top:a,bottom:c,right:u}=n(l);e.fillStyle="rgba(0, 0, 0, .5)",e.fillRect(0,0,i,c),e.fillRect(i,0,r,a),e.fillRect(u,a,r,o),e.fillRect(0,c,u,o),e.fillStyle="#33b5e5",e.fillRect(i-t.BOX_BORDER,a,t.BOX_BORDER,c-a),e.fillRect(i,a-t.BOX_BORDER,u-i,t.BOX_BORDER),e.fillRect(u,a,t.BOX_BORDER,c-a),e.fillRect(i,c,u-i,t.BOX_BORDER),e.fillStyle="#ace1f4",e.fillRect(i-t.BOX_BORDER,a-t.BOX_BORDER,t.BOX_BORDER,t.BOX_BORDER),e.fillRect(u,a-t.BOX_BORDER,t.BOX_BORDER,t.BOX_BORDER),e.fillRect(i-t.BOX_BORDER,c,t.BOX_BORDER,t.BOX_BORDER),e.fillRect(u,c,t.BOX_BORDER,t.BOX_BORDER)},t.dragBoxBounds=function(e,t,r,n){let[o,l,i,a]=e;return-1!=n.indexOf(0)&&(o+=t),-1!=n.indexOf(1)&&(l+=r),-1!=n.indexOf(2)&&(i+=t),-1!=n.indexOf(3)&&(a+=r),[Math.floor(o),Math.floor(l),Math.floor(i),Math.floor(a)]},t.chooseDraggingIndexes=function(e,r,n){if(!o(e,r,n))return[2,3];let l=r-e[0]>-t.BOX_BORDER&&r-e[0]<0,i=n-e[1]>-t.BOX_BORDER&&n-e[1]<0,a=r-e[2]>0&&r-e[2]<t.BOX_BORDER,c=n-e[3]>0&&n-e[3]<t.BOX_BORDER,u=[];return l&&u.push(0),i&&u.push(1),a&&u.push(2),c&&u.push(3),u},t.isInsideBox=o}]);