!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=React},function(e,t,n){"use strict";function r(e,t){return[e[0]*t[0]-e[1]*t[1]-e[2]*t[2]-e[3]*t[3],e[0]*t[1]+e[1]*t[0]+e[2]*t[3]-e[3]*t[2],e[0]*t[2]-e[1]*t[3]+e[2]*t[0]+e[3]*t[1],e[0]*t[3]+e[1]*t[2]-e[2]*t[1]+e[3]*t[0]]}Object.defineProperty(t,"__esModule",{value:!0}),t.eToQ=function(e){let t=Math.sin(e[3]/2);return[Math.cos(e[3]/2),e[0]*t,e[1]*t,e[2]*t]},t.qMultiply=r,t.qRotate=function(e,t){let n=t.map(e=>e*e).reduce((e,t)=>e+t,0),[i,o,l,a]=r(r(t,[0,e[0],e[1],e[2]]),[(u=t)[0],-u[1],-u[2],-u[3]]);var u;return[o/n,l/n,a/n]}},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(0)),o=r(n(3)),l=n(4),a=n(5),u=n(6);function c(){let[e,t]=i.useState(),[n,r]=i.useState(),[o,c]=i.useState();return i.useEffect(()=>{fetch("/videos").then(e=>e.json()).then(e=>r(e.videos))},[]),i.createElement("div",null,i.createElement(a.VideoListing,{callback:t,videos:n||[]}),e&&i.createElement(l.VideoController,{width:700,url:`/video?id=${e}`,callback:e=>c(e)}),i.createElement("br",null),i.createElement("br",null),i.createElement("br",null),o&&i.createElement(u.RotationMatcher,{input:o,onOutputConfirmed:e=>{var t,n;if(!o)return;let r=btoa(String.fromCharCode.apply(null,Array.from(o.data.filter((e,t)=>t%4!=3)))),i=JSON.stringify({input:{width:null===(t=o)||void 0===t?void 0:t.width,height:null===(n=o)||void 0===n?void 0:n.height,data:r},output:e});console.log(i),fetch("/skateboards",{method:"POST",body:i}).then(e=>e.json()).then(()=>c(void 0))}}))}t.PanelLayout=c,o.render(i.createElement(c,null),document.getElementById("root"))},function(e,t){e.exports=ReactDOM},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(0));t.VideoController=function(e){let[t,n]=i.useState(null),[r,o]=i.useState([0,0,0,0]),[l,a]=i.useState(!0),[u,c]=i.useState(!1),s=i.createRef(),d=i.useCallback(e=>{e&&n(e)},[]);const f=()=>{if(l)return;if(!t)return;if(!s.current)return;let{width:e,height:n}=s.current,i=s.current.getContext("2d");if(!i)return;i.clearRect(0,0,e,n),i.drawImage(t,0,0),i.fillStyle="rgba(0, 0, 0, .5)";let[o,a,u,c]=r;i.fillRect(0,0,Math.min(o,u),Math.max(a,c)),i.fillRect(Math.min(o,u),0,e,Math.min(a,c)),i.fillRect(Math.max(o,u),Math.min(a,c),e,n),i.fillRect(0,Math.max(a,c),Math.max(o,u),n)};i.useEffect(f,[l,t,r]);const h=(e,t)=>{if(!s.current)return;let{clientX:n,clientY:i}=e,{top:l,left:a,width:u,height:c}=s.current.getBoundingClientRect(),d=s.current.width*(n-a)/u,f=s.current.height*(i-l)/c;if(t)o([d,f,d,f]);else{let[e,t]=r;o([e,t,d,f])}},m=()=>{t&&(t.currentTime+=.1)};return i.createElement("div",{className:"video-container"},i.createElement("video",{onTimeUpdate:f,ref:d,controls:!0,style:{display:l?"block":"none",width:e.width}},i.createElement("source",{src:e.url,type:"video/mp4"})),null!=t&&i.createElement(i.Fragment,null,i.createElement("canvas",{ref:s,width:t.videoWidth,height:t.videoHeight,style:{display:l?"none":"block",width:e.width,height:e.width*t.videoHeight/(t.videoWidth+1),border:"1px solid black"},onMouseDown:e=>{h(e,!0),c(!0)},onMouseMove:e=>{u&&h(e,!1)},onMouseUp:e=>{h(e,!1),c(!1)}}),i.createElement("br",null),i.createElement("div",{className:"video-controls",style:{width:e.width}},i.createElement("div",{className:"video-controls-button",onClick:()=>{t&&(t.currentTime-=.1)}},"Back a little"),i.createElement("div",{className:"video-controls-button",onClick:()=>{var e,n;l?(a(!1),null===(e=t)||void 0===e||e.pause()):(a(!0),null===(n=t)||void 0===n||n.play())}},l?"Pause":"Play"),i.createElement("div",{className:"video-controls-button",onClick:m},"Forward a little"),i.createElement("div",{className:"video-controls-button",onClick:()=>{if(!s.current)return;let t=s.current.getContext("2d");t&&(e.callback(t.getImageData(r[0],r[1],r[2]-r[0],r[3]-r[1])),m())}},"Clip"))))}},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(0));t.VideoListing=function(e){let t=i.createRef(),[n,r]=i.useState();return i.createElement("div",{className:"title-container"},i.createElement("input",{type:"url",ref:t}),i.createElement("button",{onClick:e=>{var n;fetch("/video",{method:"POST",body:JSON.stringify({link:null===(n=t.current)||void 0===n?void 0:n.value}),headers:{"Content-Type":"application/json"}}).then(()=>{location.reload()})}},"Download video"),e.videos.map(({id:t,title:o},l)=>i.createElement("div",{key:l,className:"title-cell",onClick:()=>{e.callback(t),r(o)},style:{color:o==n?"red":"black"}},o)))}},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(0)),o=n(7),l=n(1);t.RotationMatcher=function(e){let[t,n]=i.useState(1),[r,a]=i.useState([Math.SQRT1_2,Math.SQRT1_2,0,0]),[u,c]=i.useState([0,0]),[s,d]=i.useState(!1),[f,h]=i.useState(!1),m=i.createRef();i.useEffect(()=>{if(!m.current)return;let{width:t,height:n}=m.current,i=m.current.getContext("2d");i&&(i.clearRect(0,0,t,n),e.input.width>e.input.height?i.putImageData(e.input,0,(e.input.width-e.input.height)/2):i.putImageData(e.input,(e.input.height-e.input.width)/2,0),o.renderSkateboard(i,r,[t/2,0,t,n]))},[m.current,e.input,r]);let p=Math.max(e.input.width,e.input.height);return i.createElement("div",null,i.createElement("canvas",{width:2*p,height:p,style:{width:Math.max(2*p,400),height:Math.max(p,200),border:"1px solid black"},contentEditable:!0,onKeyDown:()=>{d(!0)},onKeyUp:()=>{d(!1)},onMouseDown:e=>{h(!0),d(!1);let{clientX:t,clientY:n}=e;c([t,n])},onMouseMove:e=>{if(!f)return;e.preventDefault();let{clientX:t,clientY:n}=e,i=u[0]-t,o=u[1]-n;c([t,n]);let d,h=Math.sqrt(i*i+o*o);d=s?l.eToQ([0,0,1,i/100]):l.eToQ([o/h,-i/h,0,h/100]);let m=l.qMultiply(r,d),[p]=l.qRotate([1,0,0],m);p>0&&a(m)},onMouseUp:()=>h(!1),onMouseLeave:()=>h(!1),onMouseOut:()=>h(!1),ref:m}),i.createElement("br",null),i.createElement("button",{onClick:()=>n(t>.5?0:1)},(t>.5?"This is a skateboard":"This is not a skateboard")+" (click to invert)"),i.createElement("button",{onClick:()=>e.onOutputConfirmed({rotation:r,isSkateboard:t>.5?1:0}),style:{color:t>.5?"green":"red"}}," Confirm Clip "))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=[[2,.5,0],[2,-.5,0],[2.5,0,.25],[-2,.5,0],[-2,-.5,0],[-2.5,0,.25],[1.75,0,0],[1.75,-.5,-.5],[1.75,.5,-.5],[-1.75,0,0],[-1.75,-.5,-.5],[-1.75,.5,-.5]],o=[[0,1,2],[0,1,3],[1,3,4],[3,4,5],[6,7,8],[9,10,11]];t.renderSkateboard=function(e,t,n){let l=i.map(e=>r.qRotate(e,t)).map(([e,t,n])=>[e,t,n-10]).map(([e,t,n])=>[-2*e/n,-2*t/n,n]),a=o.map(([e,t,n],r)=>[Math.min(l[e][2]+l[t][2]+l[n][2]),r]);a=a.sort(([e],[t])=>e-t);let u=Math.abs(n[0]-n[2])/2,c=(n[0]+n[2])/2,s=(n[1]+n[3])/2;a.forEach(([t,n])=>{let[r,i,a]=o[n],[d,f]=l[r],[h,m]=l[i],[p,v]=l[a];e.fillStyle="black",e.strokeStyle="#d8d8d8",e.beginPath(),e.moveTo(d*u+c,f*u+s),e.lineTo(h*u+c,m*u+s),e.lineTo(p*u+c,v*u+s),e.closePath(),e.fill(),e.stroke()})}}]);